<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta name="google-site-verification" content="Sbao2yVur4CMYEsgpErDP5S6uuqaNxw3VOmmtylKbeA" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Once an Infinite Sequence, Always an Infinite Sequence</title>
    <meta name="author" content="Mark Miyashita" />
    <link href="http://feeds.feedburner.com/markmiyashita" rel="alternate" title="Mark Miyashita" type="application/atom+xml" />

    <script type="text/javascript" src="/public/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/public/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script type="text/javascript" src="/public/js/prettify.js"></script>
    <script type="text/javascript" src="/public/js/home.js"></script>

    <link rel="stylesheet" href="/public/css/normalize.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/prettify.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/projects.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/resume.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/base.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/layouts.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/home.css" type="text/css" />
    <link rel="stylesheet" href="/public/css/header.css" type="text/css" />
  </head>

  <body>
    <header id="header">
      <a href="/"><img class="profile_pic" src="/public/images/mark_miyashita_small.png"></img></a>

<h1>
  <a href="/">Mark Miyashita</a>
</h1>

<h2>
  <a href="/">negativetwelve</a>
</h2>

<h3>
  <p class="about_links">
    <a href="/resume/#education">Student</a>, <a href="/resume/#work">Software Engineer</a>, <a href="/cs61a">Teacher</a>, <a href="/blog">Aspiring Entrepreneur</a>
  </p>
</h3>

<div class="links">
  <span><a href="/">About</a></span>
  <span><a href="/projects">Projects</a></span>
  <span><a href="/resume">Resume</a></span>
  <span><a href="/blog">Blog</a></span>
  <span><a href="/cs61a/fa13">CS61A</a></span>
  <span><a href="#" id="dropdown-button">Other CS Courses</a></span>
  <span><a href="/interviews/problems">Interview Practice</a></span>
  <span><a href="/hkn">HKN</a></span>
  <span><a href="/web_dev">Web Development</a></span>
  <span><a href="/contact">Contact</a></span>
</div>
<div class="links" id="sub-links">
  <span><a href="/cs61b">CS61B</a></span>
  <span><a href="/cs61c">CS61C</a></span>
</div>


    </header>

    <section id="main_content">

      <link rel="stylesheet" href="/public/css/cs61a.css" type="text/css" />

<header id="top_bar">
  Aug 06, 2013
</header>

<article class="post">
  <a href="/cs61a/su13" class="button_link">Go Back</a>
  
  <h4>Challenge Problem</h4>
  <h2>Once an Infinite Sequence, Always an Infinite Sequence</h2>
  
  
<p>This problem is quite involved and also covers a lot of different topics from the course. Namely, it covers: type dispatching, coercion, iterators, generators, streams, dictionaries, and generic functions.</p>

<p>As a warmup, let’s write simple generators, iterators, and streams. Write one of each that represents the natural numbers stream, iterator, and generator. Think about the different components of each that you need.</p>

<pre><code>def make_natural_numbers_generator():
    "***YOUR CODE HERE***"

def make_natural_numbers_stream(first=0):
    "***YOUR CODE HERE***""

class NaturalNumbersIterator(object):
    "***YOUR CODE HERE***"
</code></pre>

<p>Now we’ll move onto type dispatching. If you haven’t already, refresh your memory with <a href="http://markmiyashita.com/cs61a/sp13/notes/generic_functions_and_type_dispatching/">this note</a>.</p>

<p>We’re going to define a generic function <code>add</code> that takes in two infinite sequences and produces a generator that represents the two sequences added together. For example, I can input the natural numbers stream and the natural numbers iterator and get back a generator where the first 5 elements are 0, 2, 4, 6, 8. To do this, we will need the <code>type_tag</code> function that we generally use for type dispatching.</p>

<pre><code>def type_tag(x):
    return type_tag.tags[type(x)]

type_tag.tags = {GeneratorType: 'generator', NaturalNumbers: 'iterator', Stream: 'stream'}
</code></pre>

<p>You can find get the class <code>GeneratorType</code> by importing from <code>types</code>: <code>from types import GeneratorType</code>.</p>

<p>Now we want to define <code>add</code>.</p>

<pre><code>def add(seq1, seq2):
    "***YOUR CODE HERE***"

add.impl = { "***YOUR CODE HERE***" }
</code></pre>

<p>Next, we need to define all of the different functions that compute the addition of the different infinite sequences that we can have. I counted 9 functions that must be created and as a hint, some can be used more than once. I created the following 6 functions. It’s a good exercise to go through all of them because it will cement your knowledge of iterators, generators, and streams.</p>

<pre><code>def add_generators(gen1, gen2):
    "*** YOUR CODE HERE***"

def add_generator_and_iterator(gen, iterator):
    "*** YOUR CODE HERE***"

def add_generator_and_stream(gen, stream):
    "*** YOUR CODE HERE***"

def add_iterator_and_stream(iterator, stream):
    "*** YOUR CODE HERE***"

def add_iterators(i1, i2):
    "*** YOUR CODE HERE***"

def add_streams(s1, s2):
    "*** YOUR CODE HERE***"
</code></pre>

<p>Now we are able to add two infinite sequences together. After you write this code, the following should work:</p>

<pre><code>&gt;&gt;&gt; s = make_natural_numbers_stream()
&gt;&gt;&gt; g = make_natural_numbers_generator()
&gt;&gt;&gt; i = NaturalNumbersIterator()
&gt;&gt;&gt; added_s_and_g = add(s, g)
&gt;&gt;&gt; next(added_s_and_g)
0
&gt;&gt;&gt; next(added_s_and_g)
2
&gt;&gt;&gt; next(added_s_and_g)
4
&gt;&gt;&gt; g2 = make_natural_numbers_generator()
&gt;&gt;&gt; added_g2_and_i = add(g2, i)
&gt;&gt;&gt; next(added_g2_and_i)
0
&gt;&gt;&gt; next(added_g2_and_i)
2
&gt;&gt;&gt; next(added_g2_and_i)
4
&gt;&gt;&gt; next(added_g2_and_i)
6
</code></pre>

<p><a href="#solution" class="solution_toggle">Toggle Solution</a></p>

<div class="solution">

  <pre><code>def make_natural_numbers_generator():
    i = 0
    while True:
        yield i
        i += 1

def make_natural_numbers_stream(first=0):
    def compute_rest():
        return make_natural_numbers_stream(first + 1)
    return Stream(first, compute_rest)

class NaturalNumbersIterator(object):
    def __init__(self):
        self.current = 0

    def __next__(self):
        next = self.current
        self.current += 1
        return next

    def __iter__(self):
        return self
</code></pre>

  <p>Here are the natural numbers generator, stream, and iterator. Remember that an iterator needs both a <code>__next__</code> and an <code>__iter__</code> method and that a Stream always keeps track of <em>how</em> to compute its rest.</p>

  <pre><code>def add(seq1, seq2):
    types = (type_tag(seq1), type_tag(seq2))
    return add.impl[types](seq1, seq2)

def add_generators(gen1, gen2):
    while True:
        yield next(gen1) + next(gen2)

def add_generator_and_iterator(gen, iterator):
    while True:
        yield next(gen) + next(iterator)

def add_generator_and_stream(gen, stream):
    while True:
        yield next(gen) + stream.first
        stream = stream.rest

def add_iterator_and_stream(iterator, stream):
    while True:
        yield next(iterator) + stream.first
        stream = stream.rest

def add_iterators(i1, i2):
    while True:
        yield next(i1) + next(i2)

def add_streams(s1, s2):
    while True:
        yield s1.first + s2.first
        s1, s2 = s1.rest, s2.rest

add.impl = {('generator', 'generator') : add_generators,
            ('generator', 'iterator') : add_generator_and_iterator,
            ('generator', 'stream') : add_generator_and_stream,
            ('iterator', 'stream') : add_iterator_and_stream,
            ('iterator', 'iterator') : add_iterators,
            ('stream', 'stream') : add_streams,
            ('stream', 'generator') : lambda s, g: add_generator_and_stream(g, s),
            ('iterator', 'generator') : lambda i, g: add_generator_and_iterator(g, i),
            ('stream', 'iterator') : lambda s, i: add_iterator_and_stream(i, s)
}
</code></pre>

</div>


  
</article>

<article class="post">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'markmiyashita'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</article>


      <section class="footer">
  <p class="copyright">
    © 2013 Mark Miyashita - <a href="http://github.com/negativetwelve">Github</a> - <a href="http://www.linkedin.com/pub/mark-miyashita/38/63/49/">LinkedIn</a> - <a href="https://plus.google.com/101180624276428786239?rel=author">Google+</a>
  </p>
</section>

    </section>

    <!-- Google Analytics -->
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-29669299-1");
    pageTracker._trackPageview();
    </script>
    <!-- Google Analytics end -->

    <script type="text/javascript">
      prettyPrint();
      var date = document.getElementsByClassName("current_date")[0];
      if (date) {
        date.innerHTML = $.datepicker.formatDate('MM dd, yy', new Date());
      }

      $(document).keypress(function(e) {
        base = document.location.origin;
        switch (e.charCode) {
          case 97: // 'a' for about
            document.location.href = base;
            break;
          case 98: // 'b' for blog
            document.location.href = base + '/blog';
            break;
          case 104: // 'h' for hkn
            document.location.href = base + "/hkn";
            break;
          case 105: // 'i' for interview practice
            document.location.href = base + "/interviews/problems";
            break;
          case 109: // 'm' for more
            $('#sub-links').slideDown('medium');
            break;
          case 112: // 'p' for projects
            document.location.href = base + '/projects';
            break;
          case 114: // 'r' for resume
            document.location.href = base + '/resume';
            break;
          case 119: // 'w' for web development
            document.location.href = base + '/web_dev';
            break;
          case 99: // 'c' for cs61a
            window.location.href = base + "/cs61a/su13";
            break;
          default:
            console.log(e.charCode);
        }
      });
    </script>

  </body>

</html>
