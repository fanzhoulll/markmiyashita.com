<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="google-site-verification" content="Sbao2yVur4CMYEsgpErDP5S6uuqaNxw3VOmmtylKbeA">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="I'm Mark, a student at the University of California, Berkeley pursuing a degree in Electrical Engineering and Computer Science. I am currently a Software Engineer at Yelp and a TA for CS61A at UC Berkeley.">
<meta name="author" content="Mark Miyashita">
<link href="http://feeds.feedburner.com/markmiyashita" rel="alternate" title="Mark Miyashita" type="application/atom+xml">

<title>
  
    CS61A - Once an Infinite Sequence, Always an Infinite Sequence - Mark Miyashita
  
</title>

<link href="/assets/css/bootstrap.css" rel="stylesheet">
<link href="/assets/css/main.css" rel="stylesheet">
<link href="/assets/css/bootstrap-overrides.css" rel="stylesheet">
<link href="/assets/css/solarized_dark.css" rel="stylesheet">

<link href="/assets/css/custom.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="assets/js/html5shiv.js"></script>
  <script src="assets/js/respond.min.js"></script>
<![endif]-->

<!-- Start of Google Analytics Code -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29669299-1']);
  _gaq.push(['_setDomainName', 'markmiyashita.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- End of Google Analytics Code -->

<!-- Start of Woopra Code -->
<script>
(function(){
  var t,i,e,n=window,o=document,a=arguments,s="script",r=["config","track","identify","visit","push","call"],c=function(){var t,i=this;for(i._e=[],t=0;r.length>t;t++)(function(t){i[t]=function(){return i._e.push([t].concat(Array.prototype.slice.call(arguments,0))),i}})(r[t])};for(n._w=n._w||{},t=0;a.length>t;t++)n._w[a[t]]=n[a[t]]=n[a[t]]||new c;i=o.createElement(s),i.async=1,i.src="//static.woopra.com/js/w.js",e=o.getElementsByTagName(s)[0],e.parentNode.insertBefore(i,e)
})("woopra");

woopra.config({
    domain: 'markmiyashita.com',
    idle_timeout: 600000
});
woopra.track('pv', {
    url: window.location.pathname+window.location.search,
    title: document.title
});
</script>
<!-- End of Woopra Code -->


  </head>
  <body>
    <a class="sr-only" href="#content">Skip navigation</a>

    <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a href="/">About</a>
        </li>
        <li>
          <a href="/resume">Resume</a>
        </li>
        <li>
          <a href="/projects">Projects</a>
        </li>
        <li>
          <a href="/blog">Blog</a>
        </li>
        <li class="active">
          <a href="/cs61a/fa13">CS61A</a>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">More CS Classes <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="/cs61b">CS61B - Data Structures</a></li>
            <li><a href="/cs61c">CS61C - Computer Architecture</a></li>
            <li><a href="/cs70">CS70 - Discrete Mathematics</a></li>
            <li><a href="/cs170">CS170 - Algorithms</a></li>
            <li><a href="/cs188">CS188 - Artificial Intelligence</a></li>
          </ul>
        </li>
        <li>
          <a href="/interviews/problems">Interview Practice</a>
        </li>
        <li >
          <a href="/blueprint">Blueprint</a>
        </li>
        <li>
          <a href="/hkn">HKN</a>
        </li>
        <li>
          <a href="/web_dev">Web Development</a>
        </li>
        <li>
          <a href="/contact">Contact</a>
        </li>
      </ul>
    </nav>
  </div>
</header>


    <div class="bs-header" id="content">
      <div class="container">
        <img class="profile-pic" src="/assets/images/mark_miyashita_small.png"></img>
        <h1>Mark Miyashita</h1>
        <h4>negativetwelve</h4>
        <p>
          <a href="/resume/#education">Student</a>, <a href="/resume/#work">Software Engineer</a>, <a href="/cs61a">Teacher</a>, <a href="/blog">Aspiring Entrepreneur</a>
        </p>
      </div>
    </div>

    
      <div class="bs-old-docs">
  <div class="container">
    Looking for more CS classes? Check out:
    
      
        <strong><a href="/cs61a">CS61A</a></strong>
      
      
      -
      
    
      
        <a href="/cs61b">CS61B</a>
      
      
      -
      
    
      
        <a href="/cs61c">CS61C</a>
      
      
      -
      
    
      
        <a href="/cs70">CS70</a>
      
      
      -
      
    
      
        <a href="/cs170">CS170</a>
      
      
      -
      
    
      
        <a href="/cs188">CS188</a>
      
      
    
  </div>
</div>

    

    


    <div class="container bs-docs-container">
      <div class="row">
          <div class="col-md-3">
  
  <div class="bs-sidebar hidden-print" role="complementary" data-spy="affix" data-offset-top="335">
  <ul class="nav bs-sidenav">






  






  
  
    <li><a href="/cs61a/fa13/practice">All Problems and Notes (54)</a></li>
  

  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/basics">Basics (3)</a></li>
      
    
  
    
    
  
    
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/higher_order_functions">Higher Order Functions (3)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/environment_diagrams">Environment Diagrams (4)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/lambdas">Lambdas (1)</a></li>
      
    
  
    
    
      
      
      
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/recursion">Recursion (8)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/rlists">Rlists (6)</a></li>
      
    
  
    
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/iterables">Iterables (2)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/object_oriented_programming">Object Oriented Programming (2)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/mutable_data">Mutable Data (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/inheritance">Inheritance (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/generic_functions">Generic Functions (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/orders_of_growth">Orders Of Growth (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/tree_recursion">Tree Recursion (7)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/memoization">Memoization (1)</a></li>
      
    
  
    
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/scheme">Scheme (6)</a></li>
      
    
  
    
    
  
    
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/tail_recursion">Tail Recursion (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/generators">Generators (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/streams">Streams (1)</a></li>
      
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/iterators">Iterators (2)</a></li>
      
    
  
    
    
  
    
    
      
      
      
      
        <li><a href="/cs61a/fa13/logic">Logic (2)</a></li>
      
    
  
    
    
  
    
    
  
    
    
  


  </ul>
</div>

</div>
<div class="col-md-9" role="main">
  <div class="page-header">
  <h3>Once an Infinite Sequence, Always an Infinite Sequence</h3>
</div>






<p>This problem is quite involved and also covers a lot of different topics from the course. Namely, it covers: type dispatching, coercion, iterators, generators, streams, dictionaries, and generic functions.</p>

<p>As a warmup, let’s write simple generators, iterators, and streams. Write one of each that represents the natural numbers stream, iterator, and generator. Think about the different components of each that you need.</p>

<pre><code>def make_natural_numbers_generator():
    "***YOUR CODE HERE***"

def make_natural_numbers_stream(first=0):
    "***YOUR CODE HERE***""

class NaturalNumbersIterator(object):
    "***YOUR CODE HERE***"
</code></pre>

<p>Now we’ll move onto type dispatching. If you haven’t already, refresh your memory with <a href="http://markmiyashita.com/cs61a/sp13/notes/generic_functions_and_type_dispatching/">this note</a>.</p>

<p>We’re going to define a generic function <code>add</code> that takes in two infinite sequences and produces a generator that represents the two sequences added together. For example, I can input the natural numbers stream and the natural numbers iterator and get back a generator where the first 5 elements are 0, 2, 4, 6, 8. To do this, we will need the <code>type_tag</code> function that we generally use for type dispatching.</p>

<pre><code>def type_tag(x):
    return type_tag.tags[type(x)]

type_tag.tags = {GeneratorType: 'generator', NaturalNumbers: 'iterator', Stream: 'stream'}
</code></pre>

<p>You can find get the class <code>GeneratorType</code> by importing from <code>types</code>: <code>from types import GeneratorType</code>.</p>

<p>Now we want to define <code>add</code>.</p>

<pre><code>def add(seq1, seq2):
    "***YOUR CODE HERE***"

add.impl = { "***YOUR CODE HERE***" }
</code></pre>

<p>Next, we need to define all of the different functions that compute the addition of the different infinite sequences that we can have. I counted 9 functions that must be created and as a hint, some can be used more than once. I created the following 6 functions. It’s a good exercise to go through all of them because it will cement your knowledge of iterators, generators, and streams.</p>

<pre><code>def add_generators(gen1, gen2):
    "*** YOUR CODE HERE***"

def add_generator_and_iterator(gen, iterator):
    "*** YOUR CODE HERE***"

def add_generator_and_stream(gen, stream):
    "*** YOUR CODE HERE***"

def add_iterator_and_stream(iterator, stream):
    "*** YOUR CODE HERE***"

def add_iterators(i1, i2):
    "*** YOUR CODE HERE***"

def add_streams(s1, s2):
    "*** YOUR CODE HERE***"
</code></pre>

<p>Now we are able to add two infinite sequences together. After you write this code, the following should work:</p>

<pre><code>&gt;&gt;&gt; s = make_natural_numbers_stream()
&gt;&gt;&gt; g = make_natural_numbers_generator()
&gt;&gt;&gt; i = NaturalNumbersIterator()
&gt;&gt;&gt; added_s_and_g = add(s, g)
&gt;&gt;&gt; next(added_s_and_g)
0
&gt;&gt;&gt; next(added_s_and_g)
2
&gt;&gt;&gt; next(added_s_and_g)
4
&gt;&gt;&gt; g2 = make_natural_numbers_generator()
&gt;&gt;&gt; added_g2_and_i = add(g2, i)
&gt;&gt;&gt; next(added_g2_and_i)
0
&gt;&gt;&gt; next(added_g2_and_i)
2
&gt;&gt;&gt; next(added_g2_and_i)
4
&gt;&gt;&gt; next(added_g2_and_i)
6
</code></pre>

<p><a href="#solution" class="solution_toggle">Toggle Solution</a></p>

<div class="solution">

  <pre><code>def make_natural_numbers_generator():
    i = 0
    while True:
        yield i
        i += 1

def make_natural_numbers_stream(first=0):
    def compute_rest():
        return make_natural_numbers_stream(first + 1)
    return Stream(first, compute_rest)

class NaturalNumbersIterator(object):
    def __init__(self):
        self.current = 0

    def __next__(self):
        next = self.current
        self.current += 1
        return next

    def __iter__(self):
        return self
</code></pre>

  <p>Here are the natural numbers generator, stream, and iterator. Remember that an iterator needs both a <code>__next__</code> and an <code>__iter__</code> method and that a Stream always keeps track of <em>how</em> to compute its rest.</p>

  <pre><code>def add(seq1, seq2):
    types = (type_tag(seq1), type_tag(seq2))
    return add.impl[types](seq1, seq2)

def add_generators(gen1, gen2):
    while True:
        yield next(gen1) + next(gen2)

def add_generator_and_iterator(gen, iterator):
    while True:
        yield next(gen) + next(iterator)

def add_generator_and_stream(gen, stream):
    while True:
        yield next(gen) + stream.first
        stream = stream.rest

def add_iterator_and_stream(iterator, stream):
    while True:
        yield next(iterator) + stream.first
        stream = stream.rest

def add_iterators(i1, i2):
    while True:
        yield next(i1) + next(i2)

def add_streams(s1, s2):
    while True:
        yield s1.first + s2.first
        s1, s2 = s1.rest, s2.rest

add.impl = {('generator', 'generator') : add_generators,
            ('generator', 'iterator') : add_generator_and_iterator,
            ('generator', 'stream') : add_generator_and_stream,
            ('iterator', 'stream') : add_iterator_and_stream,
            ('iterator', 'iterator') : add_iterators,
            ('stream', 'stream') : add_streams,
            ('stream', 'generator') : lambda s, g: add_generator_and_stream(g, s),
            ('iterator', 'generator') : lambda i, g: add_generator_and_iterator(g, i),
            ('stream', 'iterator') : lambda s, i: add_iterator_and_stream(i, s)
}
</code></pre>

</div>



<p class="disclaimer">
  I don't claim to be perfect so if you find an error on this page, please <a href="/contact">send me an email</a> preferably with a link to this page so that I know what I need to fix!
</p>

<article class="post">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'markmiyashita'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</article>

</div>
      </div>

    </div>

    <footer class="bs-footer" role="contentinfo">
      <p class="copyright">
        © 2013 Mark Miyashita
      </p>

      <ul class="footer-links">
        <li><a href="http://github.com/negativetwelve">Github</a></li>
        <li class="muted">&middot;</li>
        <li><a href="https://hkn.eecs.berkeley.edu/coursesurveys/instructor/7419">TA Ratings</a></li>
        <li class="muted">&middot;</li>
        <li><a href="https://www.facebook.com/markmiyashita12">Facebook</a></li>
        <li class="muted">&middot;</li>        
        <li><a href="http://www.linkedin.com/pub/mark-miyashita/38/63/49/">LinkedIn</a></li>
        <li class="muted">&middot;</li>
        <li><a href="https://plus.google.com/101180624276428786239?rel=author">Google+</a></li>
      </ul>
    </footer>

    <script src="/assets/js/jquery-1.8.3.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/highlight.pack.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  $(".solution_toggle").click(function(event) {
    event.preventDefault();
    $(".solution").fadeToggle('medium');
  });
});


hljs.initHighlightingOnLoad();

$(document).keypress(function(e) {
  base = document.location.origin;
  switch (e.charCode) {
    case 97: // 'a' for about
      document.location.href = base;
      break;
    case 98: // 'b' for blog
      document.location.href = base + '/blog';
      break;
    case 104: // 'h' for hkn
      document.location.href = base + "/hkn";
      break;
    case 105: // 'i' for interview practice
      document.location.href = base + "/interviews/problems";
      break;
    case 109: // 'm' for more
      $('#sub-links').slideDown('medium');
      break;
    case 112: // 'p' for projects
      document.location.href = base + '/projects';
      break;
    case 114: // 'r' for resume
      document.location.href = base + '/resume';
      break;
    case 119: // 'w' for web development
      document.location.href = base + '/web_dev';
      break;
    case 99: // 'c' for cs61a
      window.location.href = base + "/cs61a";
      break;
    default:
      console.log(e.charCode);
  }
});
</script>


  </body>
</html>
