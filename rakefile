# coding: utf-8
ROOT = File.expand_path('.')

require 'rubygems'
begin
    require 'colored'
rescue LoadError
    raise 'You must "gem install colored" to use terminal colors'
end

def die(s)
  puts(s.red)
  exit(1)
end

def sys(cmd)
    puts ("> "+cmd).blue
    system(cmd)
end

desc "run the local debug server"
task :serve do
  puts "#{"first-time setup".magenta} (markmiyashita.org will be your local dev url):"
  puts "add #{"127.0.0.1 markmiyashita.org".yellow} into #{"/etc/hosts".blue}"
  puts "tip: setup nginx to be transparent proxy for http://markmiyashita.org => http://markmiyashita.org:4002"
  puts "=> #{"http://markmiyashita.org:4002".green} or #{"http://markmiyashita.org".green} with nginx"
  puts ""
  
  sys("jekyll --auto --server 4002 --url http://markmiyashita.org")
end

desc "generate a new post"
namespace :post do
  namespace :cs61a do
    task :note, [:title] do |t, args|
      date = Time.now.strftime("%Y-%m-%d-")
      title = args[:title].gsub('-', '_').gsub(' ', '_').downcase + '.md'
      sys("cp #{ROOT}/_posts/templates/cs61a_note_template.md #{ROOT}/_posts/cs61a/notes/#{date + title}")
    end

    task :problem, [:title] do |t, args|
      date = Time.now.strftime("%Y-%m-%d-")
      title = args[:title].gsub('-', '_').gsub(' ', '_').downcase + '.md'
      sys("cp #{ROOT}/_posts/templates/cs61a_problem_template.md #{ROOT}/_posts/cs61a/problems/#{date + title}")
    end
  end
end

task :default => :serve